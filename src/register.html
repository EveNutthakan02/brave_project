<!-- //register.html -->
<!DOCTYPE html>
<html lang="th">
  <head>
    <title><%= htmlWebpackPlugin.options.title %></title>
    <style>
      iframe {
        width: 100%;
        height: 500px;
        border: none;
      }

      /*Date*/
      .calendar-container {
        width: 300px;
        margin: 20px auto;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .calendar-grid div {
        padding: 10px;
        font-size: 14px;
      }
      .calendar-grid .date {
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.2s ease;
      }
      .calendar-grid .date:hover {
        background-color: #f3f4f6;
      }
      .calendar-grid .selected {
        background-color: #6366f1;
        color: white;
      }
    </style>
  </head>

  <body>
    <div>
      <iframe src="banner.html"></iframe>
    </div>

    <div>
      <h1 class="text-3xl font-bold text-center">ลงทะเบียนผู้ขอรับสิทธิ</h1>
    </div>
    <!-- Form -->
    <div class="mt-10">
      <form>
        <div class="mx-20">
          <fieldset>
            <div class="mt-6 flex items-center justify-center space-x-6">
              <div class="flex items-center gap-x-3">
                <input
                  id="push-new"
                  name="push-notifications"
                  type="radio"
                  class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400"
                />
                <label
                  for="push-new"
                  class="block text-sm/6 font-medium text-gray-900"
                  >ยื่นเรื่องใหม่</label
                >
              </div>
              <div class="flex items-center gap-x-3">
                <input
                  id="push-broken"
                  name="push-notifications"
                  type="radio"
                  class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400"
                />
                <label
                  for="push-broken"
                  class="block text-sm/6 font-medium text-gray-900"
                  >บัตรชำรุด</label
                >
              </div>
              <div class="flex items-center gap-x-3">
                <input
                  id="push-lost"
                  name="push-notifications"
                  type="radio"
                  class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400"
                />
                <label
                  for="push-lost"
                  class="block text-sm/6 font-medium text-gray-900"
                  >บัตรสูญหาย</label
                >
              </div>
            </div>
          </fieldset>
        </div>

        <div class="space-y-12 ml-5">
          <div
            class="mx-20 text-xl font-bold mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6"
          >
            <div class="sm:col-span-1">
              <h2>ผู้มีสิทธิ</h2>
            </div>
            <div class="sm:col-span-1">
              <h2>ข้อมูลส่วนตัว</h2>
            </div>
          </div>
        </div>

        <div class="mt-10 mx-70 grid gap-y-8 sm:grid-cols-9">
          <div class="sm:col-span-2">
            <label
              for="id-card"
              class="block text-sm/6 font-medium text-gray-900"
              >เลขประจำตัวประชาชน</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="id-card"
                id="id-card"
                autocomplete="id-card"
                class="block w-48 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>

          <div class="sm:col-span-2 ml-12">
            <label
              for="title-name"
              class="block text-sm/6 font-medium text-gray-900"
              >คำนำหน้าชื่อ</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="title-name"
                id="title-name"
                autocomplete="title-name"
                class="block w-25 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>

          <div class="sm:col-span-2">
            <label
              for="first-name"
              class="block text-sm/6 font-medium text-gray-900"
              >ชื่อ</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="first-name"
                id="first-name"
                autocomplete="given-name"
                class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>

          <div class="sm:col-span-2">
            <label
              for="last-name"
              class="block text-sm/6 font-medium text-gray-900"
              >สกุล</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="last-name"
                id="last-name"
                autocomplete="family-name"
                class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>
        </div>

        <!-- Dropdown -->
        <div class="mx-70 mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6">
          <div class="text-xl font-bold sm:col-span-4">
            <h2>ราชการสงคราม</h2>
          </div>
          <div class="sm:col-span-5">
            <label
              for="war-select"
              class="block text-sm font-medium text-gray-900 mb-2"
              >เหตุการณ์สงคราม</label
            >
            <select
              id="war-select"
              name="war-select"
              class="block w-48 rounded-md border-0 bg-white px-3 py-2 text-gray-900 shadow-sm outline-1 outline-gray-300 focus:outline-2 focus:outline-indigo-600 sm:text-sm"
              onchange="updateDropdownStyle(this)"
            >
              <option value="" disabled selected class="text-gray-300">
                --เลือก--
              </option>
              <option value="ww1" class="text-gray-900">
                สงครามโลกครั้งที่ 1
              </option>
              <option value="indochina-war" class="text-gray-900">
                สงครามอินโดจีน
              </option>
              <option value="ww2" class="text-gray-900">
                สงครามโลกครั้งที่ 2
              </option>
              <option value="korean-war" class="text-gray-900">
                สงครามเกาหลี
              </option>
              <option value="vietnam-war" class="text-gray-900">
                สงครามเวียดนาม
              </option>
            </select>
          </div>
        </div>

        <!--ราชกิจจาฯ-->
        <div class="mx-70 mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6">
          <div class="text-xl font-bold sm:col-span-4">
            <h2>ราชกิจจาฯ</h2>
          </div>
          <div class="sm:col-span-5">
            <label for="book" class="block text-sm/6 font-medium text-gray-900"
              >เล่ม, ลงวันที่</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="book"
                id="book"
                autocomplete="book"
                class="block w-48 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>

          <div class="sm:col-span-5">
            <label for="pages" class="block text-sm/6 font-medium text-gray-900"
              >ตอน, หน้า, บรรทัด</label
            >
            <div class="mt-2">
              <input
                type="text"
                name="pages"
                id="pages"
                autocomplete="pages"
                class="block w-48 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
              />
            </div>
          </div>
        </div>

        <div class="space-y-12 ml-5">
          <div
            class="mx-65 text-sm font-medium mt-5 grid gap-x-6 gap-y-8 sm:grid-cols-6"
          >
            <div class="sm:col-span-5">
              <h6>
                *กรุณาใส่ตัวเลือกที่ต้องการ โดยใช้เครื่องหมายคอมม่า
                (,)เพื่อแบ่งระหว่างแต่ละตัวเลือก เช่น ถ้าต้องการใส่ตัวเลือก
                'แอปเปิ้ล กล้วย ส้ม' กรุณาพิมพ์ดังนี้ แอปเปิ้ล, กล้วย, ส้ม :
              </h6>
            </div>
          </div>
        </div>
        <!--ผู้ขอรับสิทธิ-->
        <div class="space-y-12 ml-5">
          <div
            class="mx-20 text-xl font-bold mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6"
          >
            <div class="sm:col-span-1">
              <h2>ผู้ขอรับสิทธิ</h2>
            </div>
          </div>
        </div>
        <!--select ผู้รับสิทธิ-->
        <div class="mt-10 mx-70 space-y-10">
          <fieldset>
            <div class="mt-6 space-y-6">
              <div class="flex items-center gap-y-3 gap-x-3">
                <input
                  id="push-myself"
                  name="push-option"
                  type="radio"
                  class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400"
                />
                <label
                  for="push-myself"
                  class="block text-sm/6 font-medium text-gray-900"
                  >รับสิทธิเอง</label
                >
              </div>
              <div class="flex items-center gap-y-3 gap-x-3">
                <input
                  id="push-heir"
                  name="push-option"
                  type="radio"
                  class="relative size-4 appearance-none rounded-full border border-gray-300 bg-white before:absolute before:inset-1 before:rounded-full before:bg-white checked:border-indigo-600 checked:bg-indigo-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:border-gray-300 disabled:bg-gray-100 disabled:before:bg-gray-400"
                />
                <label
                  for="push-heir"
                  class="block text-sm/6 font-medium text-gray-900"
                  >ทายาทรับสิทธิแทน</label
                >
              </div>
            </div>
          </fieldset>
        </div>
        <!--ทายาทรับสิทธิแทน-->
        <div class="mt-10">
          <form>
            <div class="mx-70 grid gap-y-8 sm:grid-cols-9">
              <div class="sm:col-span-2">
                <label
                  for="idHeir"
                  class="block text-sm/6 font-medium text-gray-200"
                  >เลขประจำตัวประชาชนทายาท</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="idHeir"
                    id="idHeir"
                    autocomplete="idHeir"
                    disabled
                    class="block w-48 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-200 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="sm:col-span-2 ml-12">
                <label
                  for="titleHeir"
                  class="block text-sm/6 font-medium text-gray-200"
                  >คำนำหน้าชื่อ</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="titleHeir"
                    id="titleHeir"
                    autocomplete="titleHeir"
                    disabled
                    class="block w-25 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-200 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="firstHeir"
                  class="block text-sm/6 font-medium text-gray-200"
                  >ชื่อ</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="firstHeir"
                    id="firstHeir"
                    autocomplete="firstHeir"
                    disabled
                    class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-200 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="lastHeir"
                  class="block text-sm/6 font-medium text-gray-200"
                  >สกุล</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="lastHeir"
                    id="lastHeir"
                    autocomplete="lastHeir"
                    disabled
                    class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-200 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>
            </div>
          </form>
        </div>

        <!--ที่หนังสือ-->
        <div class="space-y-12 ml-5">
          <div
            class="mx-20 text-xl font-bold mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6"
          >
            <div class="sm:col-span-1">
              <h2>ที่หนังสือหน่วย</h2>
            </div>
          </div>
        </div>
        <!--ที่หนังสือหน่วย-->
        <div class="mt-10">
          <form>
            <div class="mx-70 grid gap-y-8 sm:grid-cols-9">
              <div class="sm:col-span-2">
                <label
                  for="affiliationName"
                  class="block text-sm/6 font-medium text-gray-900"
                  >สังกัด</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="affiliationName"
                    id="affiliationName"
                    autocomplete="affiliationName"
                    class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="bookNum"
                  class="block text-sm/6 font-medium text-gray-900"
                  >ที่หนังสือ</label
                >
                <div class="mt-2">
                  <input
                    type="text"
                    name="bookNum"
                    id="bookNum"
                    autocomplete="bookNum"
                    class="block w-40 rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:outline-indigo-600 sm:text-sm/6"
                  />
                </div>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="bookDate"
                  class="block text-sm font-medium text-gray-900"
                >
                  เลือกวันที่
                </label>
                <div class="mt-2">
                  <input
                    type="date"
                    id="bookDate"
                    name="bookDate"
                    class="block w-40 rounded-md bg-white px-3 py-2 text-gray-900 shadow-sm outline-1 outline-gray-300 focus:outline-2 focus:outline-indigo-600 sm:text-sm"
                    value=""
                  />
                </div>
              </div>
            </div>
          </form>
        </div>

        <!--วันที่-->
        <div class="space-y-12 ml-5">
          <div
            class="mx-20 text-xl font-bold mt-10 grid gap-x-6 gap-y-8 sm:grid-cols-6"
          >
            <div class="sm:col-span-1">
              <h2>วันที่ขอรับสิทธิ</h2>
            </div>
          </div>
        </div>
        <!--วันที่ขอรับสิทธิ-->
        <div class="mx-70">
          <label
            for="dateVerify"
            class="block text-sm font-medium text-gray-900"
          >
            เลือกวันที่
          </label>
          <div class="mt-2">
            <input
              type="date"
              id="dateVerify"
              name="dateVerify"
              class="block w-40 rounded-md bg-white px-3 py-2 text-gray-900 shadow-sm outline-1 outline-gray-300 focus:outline-2 focus:outline-indigo-600 sm:text-sm"
              value=""
            />
          </div>
        </div>

        <!-- Buttons -->
        <div class="mt-6 mb-12 flex items-center justify-center gap-x-6">
          <button
            type="cancel"
            id="cancelButton"
            class="text-sm/6 font-semibold rounded-md bg-gray-200 px-3 py-2 text-black shadow-sm hover:bg-gray-300 focus-visible:outline-2 focus-visible:outline-gray-200"
            onclick="window.location.href='dashboard.html';"
          >
            ย้อนกลับ
          </button>

          <button
            type="submit"
            id="submitButton"
            class="text-sm/6 font-semibold rounded-md bg-indigo-600 px-3 py-2 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-indigo-600"
          >
            บันทึก
          </button>
        </div>
      </form>
    </div>

    <script>
      function updateDropdownStyle(selectElement) {
        if (selectElement.value === "") {
          selectElement.style.color = "#d1d5db"; //gray-300
        } else {
          selectElement.style.color = "#000";
          selectElement.style.outline = "1px solid #d1d5db"; //outline-gray-300
        }
      }

      function heirInput() {
        const pushMyself = document.getElementById("push-myself"); // ตัวเลือก "รับสิทธิเอง"
        const pushHeir = document.getElementById("push-heir"); // ตัวเลือก "ทายาทรับสิทธิแทน"

        const idHeir = document.getElementById("idHeir"); // ฟอร์ม ทายาท
        const titleHeir = document.getElementById("titleHeir");
        const firstHeir = document.getElementById("firstHeir");
        const lastHeir = document.getElementById("lastHeir");

        const idHeirLabel = document.querySelector("label[for='idHeir']"); // Label ของช่องกรอกข้อมูล
        const titleHeirLabel = document.querySelector("label[for='titleHeir']");
        const firstHeirLabel = document.querySelector("label[for='firstHeir']");
        const lastHeirLabel = document.querySelector("label[for='lastHeir']");

        if (pushMyself.checked) {
          idHeir.disabled = true; // ปิดการใช้งานฟอร์ม
          titleHeir.disabled = true;
          firstHeir.disabled = true;
          lastHeir.disabled = true;

          idHeir.value = ""; // ล้างค่าที่กรอกในฟอร์ม
          titleHeir.value = "";
          firstHeir.value = "";
          lastHeir.value = "";

          idHeir.style.outline = ""; // ลบ outline
          titleHeir.style.outline = "";
          firstHeir.style.outline = "";
          lastHeir.style.outline = "";

          idHeirLabel.style.color = ""; // รีเซ็ตสีข้อความ Label กลับเป็นค่าเริ่มต้น
          titleHeirLabel.style.color = "";
          firstHeirLabel.style.color = "";
          lastHeirLabel.style.color = "";
        } else if (pushHeir.checked) {
          idHeir.disabled = false; // เปิดการใช้งานฟอร์ม
          titleHeir.disabled = false;
          firstHeir.disabled = false;
          lastHeir.disabled = false;

          idHeir.style.outline = "1px solid #d1d5db"; // เพิ่ม outline สี gray-300
          titleHeir.style.outline = "1px solid #d1d5db";
          firstHeir.style.outline = "1px solid #d1d5db";
          lastHeir.style.outline = "1px solid #d1d5db";

          idHeirLabel.style.color = "#111827"; // เปลี่ยนสีข้อความ Label เป็นสีเทา (gray-900)
          titleHeirLabel.style.color = "#111827";
          firstHeirLabel.style.color = "#111827";
          lastHeirLabel.style.color = "#111827";
        }
      }
      // ตั้งค่าการทำงานเริ่มต้นเมื่อโหลดหน้าเว็บ selectผู้รับสิทธิ
      window.addEventListener("DOMContentLoaded", heirInput);
      // เพิ่ม Event Listener ให้กับปุ่มทั้งสอง
      document
        .getElementById("push-myself")
        .addEventListener("change", heirInput);
      document
        .getElementById("push-heir")
        .addEventListener("change", heirInput);

      // ตั้งค่าเริ่มต้นให้ option สีเทา "เลือก"สงคราม
      window.addEventListener("DOMContentLoaded", function () {
        const selectElement = document.getElementById("war-select");
        updateDropdownStyle(selectElement); // เรียกใช้เมื่อตอนโหลดหน้าเว็บ
      });

      //Date
      document.addEventListener("DOMContentLoaded", function () {
        const today = new Date().toISOString().split("T")[0]; // แปลงวันที่ปัจจุบันให้อยู่ในรูปแบบ
        document.getElementById("bookDate").value = today; // ตั้งค่าลงใน input วันที่ลงหนังสือหน่วย
        document.getElementById("dateVerify").value = today; // ตั้งค่าลงใน inputวันที่ขอรับสิทธิ
      });

      // จัดการ Event เมื่อกดปุ่ม "บันทึก"
      document
        .getElementById("submitButton")
        .addEventListener("click", async (event) => {
          event.preventDefault(); // ป้องกันการส่งฟอร์มแบบปกติ

          // ดึงข้อมูลจากฟอร์ม
          const data = {
            pushNotifications: document.querySelector(
              'input[name="push-notifications"]:checked'
            )?.id, //ประเภท
            idCard: document.getElementById("id-card").value, //ปชช.ผู้มีสิทธิ
            titleName: document.getElementById("title-name").value, //คำนำ
            firstName: document.getElementById("first-name").value, //ชื่อ
            lastName: document.getElementById("last-name").value, //สกุล
            warEvent: document.getElementById("war-select").value, //ราชสงคราม
            book: document.getElementById("book").value, //ราชกิจจาฯ เล่ม?
            pages: document.getElementById("pages").value, //ราชกิจจาฯ หน้า?
            pushOption: document.querySelector(
              'input[name="push-option"]:checked'
            )?.id, //ผู้ขอรับสิทธิ
            idHeir: document.getElementById("idHeir").value,
            titleHeir: document.getElementById("titleHeir").value,
            firstHeir: document.getElementById("firstHeir").value,
            lastHeir: document.getElementById("lastHeir").value,

            affiliationName: document.getElementById("affiliationName").value, //สังกัด
            bookNum: document.getElementById("bookNum").value,
            bookDate: document.getElementById("bookDate").value,
            dateVerify: document.getElementById("dateVerify").value,
          };
          //ทายาทรับสิทธิแทน
          if (document.getElementById("push-heir").checked) {
            data.idHeir = document.getElementById("idHeir").value;
            data.titleHeir = document.getElementById("titleHeir").value;
            data.firstHeir = document.getElementById("firstHeir").value;
            data.lastHeir = document.getElementById("lastHeir").value;
          }
          //ไม่ได้กรอกข้อมูลทายาท
          if (document.getElementById("push-heir").checked) {
            if (
              !data.idHeir ||
              !data.titleHeir ||
              !data.firstHeir ||
              !data.lastHeir
            ) {
              alert("กรุณากรอกข้อมูลของทายาทให้ครบถ้วน");
              return;
            }
          }

          // ส่งข้อมูลไปยัง API
          try {
            const response = await fetch("http://localhost:3000/submit", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              alert("บันทึกข้อมูลสำเร็จ!");
              window.location.href = "dashborad.html"; // เปลี่ยนไปหน้า after_register.html
            
            } else {
              alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("ไม่สามารถเชื่อมต่อกับ API ได้");
          }
        });
    </script>
  </body>
</html>
